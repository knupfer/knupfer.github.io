* Shell

#+BEGIN_SRC sh :exports results

#!/bin/sh

echo '---
layout: default
title: Index
---
<div id="table-of-contents2">
<h3>Index</h3>
<div id="text-table-of-contents2">
<ul>' > totalindex;

for FILE in *.org
do
    if [ $FILE != 'publish.org' ]
    then
        DATEI=$(echo $FILE | sed 's_\(.*\).org_\1_');
        URL=$(echo /$DATEI | sed 's_-_/_; s_-_/_; s_-_/_; s_$_.html_')
        TITLE=$(sed -n '2,/---/ s_title: *"*\([^"]*\)"*_\1_p' $DATEI.org);
        FATHER=$(sed -n '2,/---/ s_father: *"*\([^"]*\)"*_\1_p' $DATEI.org);
        
        test -e $DATEI.html &&
        
        echo '<li><a href="'$URL'">'$TITLE'</a>' >> categorie.$FATHER &&
        sed -n '/<div id="text-table-of-contents">/,/<\/div>/ p' $DATEI.html | 
            tail -n +2 | 
            head -n -1 | 
        sed 's:\(href="\)#:\1'$URL'#:g' >> categorie.$FATHER &&
        sed -n '/---/,/---/ p' $DATEI.org > $DATEI.org.publish &&
        sed 'N;
            s_[(</ul>)(</dl>)]\n</div>_&<p></p>_;
            P;
            s_file:///_/_;
            s_<h2>Table of Contents</h2>_<h3>Inhaltsverzeichnis</h3>_;
            D' $DATEI.html >> $DATEI.org.publish &&
        cat $DATEI.org.publish > ../_posts/$DATEI.html &&
        rm  $DATEI.org.publish;
    fi
done

for INDEX in categorie.*
do
    if [ "$(echo $INDEX | sed 's_categorie\(.*\)_\1_')" != '.' ]
    then
        echo '<li><a href="">' $(echo $INDEX | 
            sed 's_categorie\.\(.*\)_\1_') '</a>' '<ul>' >> totalindex;
    else
        echo '<li><a href="">' Verschiedenes '</a>' '<ul>' >> totalindex;
    fi
    cat $INDEX >> totalindex;
    echo '</ul>' >> totalindex;
done

echo '</ul></div></div>' >> totalindex;
mv totalindex  ../totalindex.html;
rm categorie.*;
cp ../_posts/about.html ../about.html;
#+END_SRC

#+RESULTS:
